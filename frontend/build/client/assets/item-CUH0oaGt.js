import{g as k,r as y,j as r}from"./jsx-runtime-BVzQf6E0.js";import{T as x,q as I,m as $,I as w}from"./width_limit-CngMnDB3.js";import{B as f}from"./index-BJsTzASz.js";import{C as v,B as C,I as g}from"./index-K5r8TNW_.js";import{L}from"./loading_infinite-CfIMpOUb.js";import{S as E}from"./page_header-p8RXdD20.js";import{d as N,p as P,j as U,k as W,c as B,f as F}from"./client-c40QJxix.js";import{L as M}from"./loading-dEFtmIfz.js";import{I as S}from"./IconDownload-CaETeKSy.js";var H=function(e){return e instanceof RegExp},O=function(t){var a=/[\\^$.*+?()[\]{}|]/g,o=RegExp(a.source);return t&&o.test(t)?t.replace(a,"\\$&"):t},D=function(e){return typeof e=="string"},q=function(e){var t=[];return e.forEach(function(a){Array.isArray(a)?t=t.concat(a):t.push(a)}),t};function G(e,t,a){var o=0,i=0;if(e==="")return e;if(!e||!D(e))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var l=t;H(l)||(l=new RegExp("("+O(l)+")","gi"));for(var s=e.split(l),n=1,d=s.length;n<d;n+=2){if(s[n]===void 0||s[n-1]===void 0){console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}i=s[n].length,o+=s[n-1].length,s[n]=a(s[n],n,o),o+=i}return s}var K=function(t,a,o){return Array.isArray(t)||(t=[t]),q(t.map(function(i){return D(i)?G(i,a,o):i}))};const X=k(K);var Y=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,a=[],o=0;o<e.rangeCount;o++)a.push(e.getRangeAt(o));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return e.removeAllRanges(),function(){e.type==="Caret"&&e.removeAllRanges(),e.rangeCount||a.forEach(function(i){e.addRange(i)}),t&&t.focus()}},J=Y,R={"text/plain":"Text","text/html":"Url",default:"Text"},Q="Copy to clipboard: #{key}, Enter";function V(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}function Z(e,t){var a,o,i,l,s,n,d=!1;t||(t={}),a=t.debug||!1;try{i=J(),l=document.createRange(),s=document.getSelection(),n=document.createElement("span"),n.textContent=e,n.ariaHidden="true",n.style.all="unset",n.style.position="fixed",n.style.top=0,n.style.clip="rect(0, 0, 0, 0)",n.style.whiteSpace="pre",n.style.webkitUserSelect="text",n.style.MozUserSelect="text",n.style.msUserSelect="text",n.style.userSelect="text",n.addEventListener("copy",function(c){if(c.stopPropagation(),t.format)if(c.preventDefault(),typeof c.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var p=R[t.format]||R.default;window.clipboardData.setData(p,e)}else c.clipboardData.clearData(),c.clipboardData.setData(t.format,e);t.onCopy&&(c.preventDefault(),t.onCopy(c.clipboardData))}),document.body.appendChild(n),l.selectNodeContents(n),s.addRange(l);var m=document.execCommand("copy");if(!m)throw new Error("copy command was unsuccessful");d=!0}catch(c){a&&console.error("unable to copy using execCommand: ",c),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),d=!0}catch(p){a&&console.error("unable to copy using clipboardData: ",p),a&&console.error("falling back to prompt"),o=V("message"in t?t.message:Q),window.prompt(o,e)}}finally{s&&(typeof s.removeRange=="function"?s.removeRange(l):s.removeAllRanges()),n&&document.body.removeChild(n),i()}return d}var ee=Z;const te=k(ee);function re(e,t){var a=y.useState(!1),o=a[0],i=a[1],l=t&&t.successDuration;return y.useEffect(function(){if(o&&l){var s=setTimeout(function(){i(!1)},l);return function(){clearTimeout(s)}}},[o,l]),[o,function(){var s=te(e);i(s)}]}function ne({meta_id:e}){if(e){let t=function(){return N(e)};return r.jsx(M,{useData:t,children:a=>ae({meta:a})})}return r.jsx(v,{children:"未知"})}const h=200;function ae({meta:e}){var o;const t=(o=e.tv)!=null&&o.poster_path?r.jsx("a",{style:{width:h,height:h*1.5},href:`/meta/${e.id}`,children:r.jsx("img",{style:{width:"100%",height:"100%"},alt:"poster",src:`https://image.tmdb.org/t/p/original/${e.tv.poster_path}`})}):null,a=e.broadcast?P(e.broadcast):{};return r.jsx(v,{cover:t,style:{maxWidth:h},children:r.jsx(v.Meta,{title:e.title,description:U(a)})})}const{Text:u}=$;function ge({item:e,show_meta:t}){var b,j;const[a,o]=re(e.torrent,{successDuration:1e3}),[i,l]=y.useState(!1),s=W(),n=B(),d=()=>{i||(s.POST("/entry/{id}/download",{params:{path:{id:e.id}}}),l(!0),setTimeout(()=>l(!1),1e3))},m=r.jsxs(E,{align:"start",children:[e.pub_date?r.jsx(x,{position:"right",content:e.pub_date.toLocaleString(),children:r.jsx(u,{size:"small",type:"tertiary",children:F(e.pub_date)})}):null,r.jsxs(u,{type:"tertiary",size:"small",children:["来自",r.jsx(u,{size:"inherit",weight:400,style:{maxWidth:"15em",overflow:"hidden",textOverflow:"ellipsis",marginLeft:".2em"},link:e.link?{href:e.link,target:"_blank"}:void 0,children:e.sourcer})]})]}),c=e.elements.EpisodeNumber?r.jsxs(r.Fragment,{children:["第",e.elements.EpisodeNumber,"集"]}):null,p=r.jsx(u,{style:{fontSize:"16px",fontWeight:t?300:500},children:r.jsxs(r.Fragment,{children:[t&&e.meta_id&&r.jsx(u,{style:{fontSize:"inherit",textDecoration:"none",fontWeight:500,marginRight:".5em"},link:{href:`/meta/${(b=e.meta_id)==null?void 0:b.$oid}`},children:e.meta_title}),c]})}),_=e.meta_id&&(n?p:r.jsx(I,{content:r.jsx(ne,{meta_id:(j=e.meta_id)==null?void 0:j.$oid}),trigger:"hover",position:"right",children:p})),T=r.jsx(u,{size:t?"small":"normal",link:{href:`/entry/${e.id}`},style:{wordWrap:"break-word",wordBreak:"break-all",cursor:e.link?"pointer":"default",fontWeight:400,letterSpacing:"-0.5px","--semi-color-link":"var(--semi-color-text-2)"},children:e.group?X(e.title,e.group,()=>r.jsx(u,{size:"inherit",style:{color:"rgba(var(--semi-teal-7))"},children:e.group})):e.title}),z=r.jsxs(C,{children:[r.jsx(x,{content:"复制链接",children:r.jsx(f,{theme:"borderless",style:{color:"rgba(var(--semi-grey-3))"},icon:a?r.jsx(g,{}):r.jsx(w,{}),onClick:o})}),r.jsx(x,{content:"下载",children:r.jsx(f,{theme:"borderless",icon:i?r.jsx(g,{}):r.jsx(S,{}),onClick:d})})]}),A=r.jsxs(C,{style:{alignSelf:"flex-end"},children:[r.jsx(f,{theme:"borderless",style:{color:"rgba(var(--semi-grey-3))"},icon:a?r.jsx(g,{size:"small"}):r.jsx(w,{size:"small"}),onClick:o,children:"复制"}),r.jsx(f,{theme:"borderless",icon:i?r.jsx(g,{size:"small"}):r.jsx(S,{size:"small"}),onClick:d,children:"下载"})]});return r.jsx(L.Item,{style:{width:"100%",padding:"16px 0",paddingTop:n?"24px":void 0},main:r.jsxs(E,{vertical:!0,align:"start",className:"entry-list-item",spacing:"tight",children:[m,_,T,n?A:null]}),extra:n?null:z})}export{ge as E};
